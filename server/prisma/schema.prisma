generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Prisma schema

model User {
  userId             String               @id @default(uuid()) // Change uuid() to auto() for the primary key
  email              String               @unique
  userName           String               @unique
  password           String
  userStatus         UserStatus           @default(ACTIVE)
  createdAt          DateTime             @default(now()) @db.Timestamptz(0)
  updatedAt          DateTime             @updatedAt @db.Timestamptz(0)
  role               UserRoles
  tenant             Tenant?
  propertyOwner      PropertyOwner?
  serviceProvider    ServiceProvider?
  SavedItem          SavedItem[]
  PaymentInformation PaymentInformation[]

  @@map("users")
}

model PropertyOwner {
  propertyOwnerId      String               @id @default(uuid())
  firstName            String
  lastName             String
  phoneNumber          String?
  profileImage         String?
  paypalBussinessEmail String?              @unique
  paypalMerchentId     String?              @unique
  createdAt            DateTime             @default(now()) @db.Timestamptz(0)
  updatedAt            DateTime             @updatedAt @db.Timestamptz(0)
  userId               String               @unique
  user                 User                 @relation(fields: [userId], references: [userId], onDelete: Cascade)
  properties           Property[]
  maintenanceRequests  MaintenanceRequest[]
  orders               Order[]
  reports              Report[]
  FinancialAccount     FinancialAccount?

  @@map("propertyOwners")
}

model Tenant {
  tenantId                             String               @id @default(uuid()) // Change uuid() to auto() for the primary key
  userId                               String               @unique
  // personal information
  firstName                            String
  lastName                             String
  profileImage                         String?
  dateOfBirth                          DateTime?
  socialSecurityNumber                 String?
  presentAddress                       String?
  phoneNumber                          String?
  drivingLicenseNumber                 String?
  isCriminalRecord                     Boolean?
  criminalRecordDescription            String?
  // rental history
  prevLandlordName                     String?
  prevLandlordContactInfo              String?
  lengthOfPrevTenancy                  String?
  affordableRentAmount                 Int?
  leavingReason                        String?
  isAnyLatePaymentReason               String?
  // income information
  CurrentEmployerOrBusinessName        String?
  CurrentEmployerOrBusinessContactInfo String?
  JobTitle                             String?
  AnnualSalary                         Int?
  OtherIncomeSource                    String?
  CurrentCreditScore                   Int?
  // pets
  isPets                               Boolean?
  typeOfPets                           String?
  isPetVaccinated                      Boolean?
  // other information
  isSmoker                             Boolean?
  allergies                            String?
  isHaveOtherMember                    Boolean?
  numberOfMember                       Int?
  isWillingToSignLeasingAgreement      Boolean?
  isAnyExtraToMention                  String?
  // 
  createdAt                            DateTime             @default(now()) @db.Timestamptz(0)
  updatedAt                            DateTime             @updatedAt @db.Timestamptz(0)
  user                                 User                 @relation(fields: [userId], references: [userId])
  SavedItem                            SavedItem[]
  // assigned in property
  propertyId                           String?              @unique
  property                             Property?            @relation(fields: [propertyId], references: [propertyId], onDelete: SetNull)
  maintenanceRequests                  MaintenanceRequest[]
  orders                               Order[]

  @@map("tenants")
}

model Property {
  propertyId               String   @id @default(uuid())
  title                    String   @default("Property Title")
  numOfBed                 Int      @default(1)
  numOfBath                Int      @default(1)
  monthlyRent              Int      @default(1)
  address                  String
  description              String
  maintenanceCoveredTenant String
  maintenanceCoveredOwner  String
  schools                  String
  universities             String
  allowedPets              String
  images                   String[]
  isRented                 Boolean  @default(false)
  planType                 PlanType @default(PENDING)
  isActive                 Boolean  @default(true)
  createdAt                DateTime @default(now())
  updatedAt                DateTime @updatedAt

  ownerId String
  owner   PropertyOwner @relation(fields: [ownerId], references: [propertyOwnerId], onDelete: SetDefault)

  SavedItem           SavedItem[]
  Tenant              Tenant?
  // 
  maintenanceRequests MaintenanceRequest[]
  serviceProviders    ServiceProvider[]

  // Many to many relation with Order
  orders Order[]

  @@map("properties")
}

model Report {
  reportId            String        @id @default(uuid())
  // monthly and annual
  reportType          ReportType
  propertyName        String
  propertyInformation Json
  // monthly
  rentAmount          Float
  collectedRent       Float
  // annual
  expenses            Float?
  // total
  grossProfit         Float
  taxDocumentFile     String?
  // 
  propertyOwnerId     String
  propertyOwner       PropertyOwner @relation(fields: [propertyOwnerId], references: [propertyOwnerId], onDelete: Cascade)
  // 
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
}

enum ReportType {
  Monthly
  Annually
  Tax
}

model Order {
  // 
  orderId            String               @id @default(uuid())
  properties         Property[]
  orderStatus        OrderStatus          @default(PENDING)
  // 
  ownerId            String?
  owner              PropertyOwner?       @relation(fields: [ownerId], references: [propertyOwnerId], onDelete: SetNull)
  // 
  tenantId           String?
  tenant             Tenant?              @relation(fields: [tenantId], references: [tenantId], onDelete: SetNull)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  PaymentInformation PaymentInformation[]
}

model ServiceProvider {
  serviceProviderId   String               @id @default(uuid())
  firstName           String
  lastName            String
  profileImage        String?
  phoneNumber         String?
  companyName         String?
  companyAddress      String?
  companyPhoneNumber  String?
  companyEmailAddress String?
  userId              String               @unique
  createdAt           DateTime             @default(now()) @db.Timestamptz(0)
  updatedAt           DateTime             @updatedAt @db.Timestamptz(0)
  user                User                 @relation(fields: [userId], references: [userId], onDelete: Cascade)
  Service             Service?
  SavedItem           SavedItem[]
  properties          Property[]
  maintenanceRequest  MaintenanceRequest[]

  @@map("serviceProviders")
}

model MaintenanceRequest {
  maintenanceRequestId String                         @id @default(uuid())
  propertyId           String
  property             Property                       @relation(fields: [propertyId], references: [propertyId], onDelete: SetNull)
  tenantId             String
  tenant               Tenant                         @relation(fields: [tenantId], references: [tenantId], onDelete: SetNull)
  ownerId              String
  owner                PropertyOwner                  @relation(fields: [ownerId], references: [propertyOwnerId], onDelete: SetNull)
  createdAt            DateTime                       @default(now())
  updatedAt            DateTime                       @updatedAt
  // 
  isAnimal             Boolean?
  animalDetails        String?
  // 
  issueLocation        String
  priority             RequestMaintenancePriorityEnum
  issueType            ServiceType
  description          String
  images               String[]
  status               MaintenanceRequestStatus       @default(PENDING)
  // 
  serviceProviderId    String?
  serviceProvider      ServiceProvider?               @relation(fields: [serviceProviderId], references: [serviceProviderId], onDelete: SetNull)

  @@map("maintenance_requests")
}

// ! not needed , will be deleted

model Service {
  serviceId                 String                   @id @default(uuid())
  minPrice                  Float?
  maxPrice                  Float?
  serviceDescription        String?
  serviceLocation           String?
  serviceCancellationPolicy String?
  serviceAvailability       ServiceAvailabilityEnum?
  serviceType               ServiceType?
  ownerId                   String?                  @unique
  owner                     ServiceProvider?         @relation(fields: [ownerId], references: [serviceProviderId], onDelete: Cascade)
  createdAt                 DateTime                 @default(now())
  updatedAt                 DateTime                 @updatedAt

  @@map("Services")
}

model SavedItem {
  itemId            String           @id @default(uuid())
  itemType          ItemType
  serviceProviderId String?
  serviceProvider   ServiceProvider? @relation(fields: [serviceProviderId], references: [serviceProviderId], onDelete: SetNull)
  tenantId          String?
  tenant            Tenant?          @relation(fields: [tenantId], references: [tenantId], onDelete: SetNull)
  propertyId        String?
  property          Property?        @relation(fields: [propertyId], references: [propertyId], onDelete: SetNull)
  userId            String
  user              User             @relation(fields: [userId], references: [userId], onDelete: SetDefault)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  @@unique([userId, serviceProviderId])
  @@unique([userId, tenantId])
  @@unique([userId, propertyId])
}

model PaymentInformation {
  id                     String   @id @default(uuid())
  platform               PLATFORM
  paymentStatus          String
  amountToPay            Float
  amountPaid             Float
  currency               String
  platformFee            Float
  netAmount              Float
  paymentPlatformId      String
  transactionCreatedTime DateTime
  orderId                String
  order                  Order    @relation(fields: [orderId], references: [orderId], onDelete: Cascade)
  userId                 String
  user                   User     @relation(fields: [userId], references: [userId], onDelete: SetDefault)
  createdAt              DateTime @default(now()) @db.Timestamptz(0)
  updatedAt              DateTime @updatedAt @db.Timestamptz(0)
}

model FinancialAccount {
  id               String        @id @default(uuid())
  finOrgAccountId  String        @unique
  email            String?       @unique
  externalAccount  Json?
  payoutsEnable    Boolean       @default(false)
  chargesEnabled   Boolean       @default(false)
  transfers        Boolean       @default(false)
  isCustomAccount  Boolean       @default(true)
  detailsSubmitted Boolean       @default(false)
  // userId           String  @unique
  // user             User    @relation(fields: [userId], references: [userId], onDelete: Cascade)
  ownerId          String        @unique
  propertyOwner    PropertyOwner @relation(fields: [ownerId], references: [propertyOwnerId], onDelete: Cascade)

  createdAt DateTime @default(now()) @db.Timestamptz(0)
  updatedAt DateTime @updatedAt @db.Timestamptz(0)
}

enum PLATFORM {
  PAYPAL
  STRIPE
}

// enums
enum UserStatus {
  ACTIVE
  PAUSED
  SUSPENDED
}

enum OrderStatus {
  PENDING
  CONFIRMED
  FAILED
}

enum PlanType {
  PENDING
  ON_TRIAL
  PREMIUM
}

enum MaintenanceRequestStatus {
  PENDING
  APPROVED
  ACTIVE
  PAUSED
  CANCEL
  COMPLETED
}

enum ServiceType {
  TENANT_SCREENING
  MAINTENANCE_AND_REPAIR
  CLEANING
  PEST_CONTROL
  LAWN_CARE
  SECURITY_AND_SAFETY
  INSURANCE
  INSPECTION
  MARKETING
  TECHNOLOGY
}

enum ServiceAvailabilityEnum {
  LOW_PRIORITY
  MEDIUM_PRIORITY
  HIGH_PRIORITY
  ALL_PRIORITIES
}

enum UserRoles {
  SUPERADMIN
  TENANT
  PROPERTY_OWNER
  SERVICE_PROVIDER
}

enum ItemType {
  PROPERTY
  PROPERTY_OWNER
  SERVICE
  TENANT
}

enum RequestMaintenancePriorityEnum {
  LOW_PRIORITY
  MEDIUM_PRIORITY
  HIGH_PRIORITY
}
